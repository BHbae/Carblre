<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.carblre.repository.CommentRepository">

    <select id="selectCommentsByCriteria" resultType="com.carblre.dto.CommentDTO">
        SELECT
        p.id AS postId,
        p.title,
        p.content,
        p.create_at AS createdAt,
        c.comment
        c.create_at
        c.user_id
        u.user_name AS userName,
        u.role AS userRole
        FROM
        post_tb p
        LEFT JOIN
        user_tb u ON p.user_id = u.id
        LEFT JOIN
        comment_tb c ON p.user_id = c.user_id
        WHERE
        p.id = #{id};  <!-- postId로 수정 -->
        <choose>
            <when test="sortBy == 'newest'">
                ORDER BY bc.created_at DESC  <!-- 최신순 -->
            </when>
            <when test="sortBy == 'oldest'">
                ORDER BY bc.created_at ASC   <!-- 오래된 순 -->
            </when>
            <otherwise>
                ORDER BY bc.created_at DESC  <!-- 기본값: 최신순 -->
            </otherwise>
        </choose>
    </select>

    <insert id="insertComment" parameterType="com.carblre.dto.CommentDTO">
        INSERT INTO comment_tb (post_id, user_id, comment, create_at)
        VALUES (#{postId}, #{userId}, #{comment}, NOW())
    </insert>






</mapper>