<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.carblre.repository.interfaces.CommentRepository">

    <select id="selectCommentsByCriteria" resultType="com.carblre.dto.CommentDTO">
        SELECT
        p.title,
        p.content,
        u.user_name,
        u.nick_name,
        u.role,
        p.create_at,
        c.comment,
        c.create_at
        FROM
        post_tb AS p
        LEFT JOIN comment_tb AS c
        ON p.id = c.post_id
        LEFT JOIN user_tb AS u
        ON p.user_id = u.id
        WHERE p.id = #{id}
        <choose>
            <when test="sortBy == 'newest'">
                ORDER BY c.create_at DESC  <!-- 최신순 -->
            </when>
            <when test="sortBy == 'oldest'">
                ORDER BY c.create_at ASC   <!-- 오래된 순 -->
            </when>
            <otherwise>
                ORDER BY c.create_at DESC  <!-- 기본값: 최신순 -->
            </otherwise>
        </choose>
    </select>

    <insert id="insertComment" parameterType="com.carblre.dto.CommentDTO">
        INSERT INTO comment_tb (post_id, user_id, comment, create_at)
        VALUES (#{postId}, #{userId}, #{comment}, NOW())
    </insert>


</mapper>